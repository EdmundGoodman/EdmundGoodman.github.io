<!doctype html><html lang=en-gb><head><meta name=author content="Edmund Goodman"><meta name=description content="The personal website for Edmund Goodman"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/images/favicon.ico sizes=any type=image/x-icon><title>Update Bot | Edmund Goodman</title>
<link rel=stylesheet href=https://edmundgoodman.github.io/scss/main.min.css></head><body><nav><ul class=nav-menu><li class="nav-item nav-home"><a href=/>Home</a></li><li class="nav-item nav-elided"><a href=/about>About</a></li><li class="nav-item nav-elided"><a href=/posts/>Blog</a></li><li class=nav-item><a href=/atlas/>Atlas</a></li></ul></nav><main><header><h1>Update Bot</h1><div class=post-meta><svg width="1.25em" height="1.25em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-bottom:-.3em"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 7a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V7z"/><path d="M16 3v4"/><path d="M8 3v4"/><path d="M4 11h16"/><path d="M7 14h.013"/><path d="M10.01 14h.005"/><path d="M13.01 14h.005"/><path d="M16.015 14h.005"/><path d="M13.015 17h.005"/><path d="M7.01 17h.005"/><path d="M10.01 17h.005"/></svg>
<time datetime=2024-10-27>Oct 27, 2024</time>
&nbsp;&bull;&nbsp;
<svg width="1.25em" height="1.25em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-bottom:-.3em"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 7v5l3 3"/></svg>
3 minutes</div><br></header><article><p><code>uv</code> is great! But it is not supported by Dependabot yet. I built a
simple GitHub Actions workflow to act as a stop-gap until support is added.</p><p>The repository containing a demo and the README on which this post is based
is <a href=https://github.com/EdmundGoodman/update-bot>available here</a>.</p><h2 id=motivation>Motivation</h2><p><a href=https://docs.astral.sh/uv/><code>uv</code></a> is developed by <a href=https://astral.sh/>Astral</a>,
who also wrote <a href=https://docs.astral.sh/ruff/><code>ruff</code></a>. It offers the benefits of
much faster dependency resolution and installation, along with leveraging the
more modern <code>pyproject.toml</code> configuration format defined in PEPs
<a href=https://peps.python.org/pep-0518/>518</a> and
<a href=https://peps.python.org/pep-0621/>618</a>.</p><p><a href=https://docs.github.com/en/code-security/getting-started/dependabot-quickstart-guide#about-dependabot>Dependabot</a> is a GitHub native code tool
which helps manage dependencies, with a focus on avoiding known security
vulnerabilities. It can provide alerts and raise pull requests against
repositories to ensure its dependencies are up-to-date and secure.</p><p>However, at time of writing (27th October 2024), Dependabot does not support
<code>uv</code> as a package ecosystem. However, the behaviour of PRs to version bump
dependencies, especially relating to security vulnerabilities, is still very
desirable.</p><p>Whilst there is <a href=https://github.com/dependabot/dependabot-core/issues/10039>ongoing work</a>
<a href=https://github.com/dependabot/dependabot-core/issues/10478>to support this</a>,
it is not ready yet. There are also some other solutions around this suggested
<a href=https://docs.astral.sh/uv/guides/integration/dependency-bots/>in the uv docs</a>
for this functionality, such as using an alternative like
<a href=https://github.com/renovatebot/renovate>Renovate</a>. However, Renovate has
compromises such as being non-native to GitHub and
<a href=https://docs.renovatebot.com/getting-started/running/>requiring complicated configuration</a>.</p><p>In the meantime, a small GitHub Actions workflow to approximate the
functionality in a lightweight way is a helpful thing to have.</p><h2 id=workflow>Workflow</h2><p>The workflow to create pull requests to bump lockfile versions is shown in its
entirety below, duplicated from
<a href=https://github.com/EdmundGoodman/update-bot/blob/main/.github/workflows/update-bot.yaml>https://github.com/EdmundGoodman/update-bot/blob/main/.github/workflows/update-bot.yaml</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>update-bot</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>workflow_dispatch</span>:
</span></span><span style=display:flex><span>  <span style=color:#75715e># Set the schedule, for example every week at 8:00am on Monday</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>schedule</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>cron</span>: <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>8</span> * * <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>permissions</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>contents</span>: <span style=color:#ae81ff>write</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>pull-requests</span>: <span style=color:#ae81ff>write</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>lock</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v4</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>astral-sh/setup-uv@v3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          echo &#34;\`\`\`&#34; &gt; uv_output.md
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          uv lock &amp;&gt;&gt; uv_output.md
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          echo &#34;\`\`\`&#34; &gt;&gt; uv_output.md</span>          
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Create pull request</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>peter-evans/create-pull-request@v7</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>token</span>: <span style=color:#ae81ff>${{ secrets.GITHUB_TOKEN }}</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>commit-message</span>: <span style=color:#ae81ff>Update uv lockfile</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>title</span>: <span style=color:#ae81ff>Update uv lockfile</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>body-path</span>: <span style=color:#ae81ff>uv_output.md</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>branch</span>: <span style=color:#ae81ff>update-uv</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>base</span>: <span style=color:#ae81ff>main</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>labels</span>: <span style=color:#ae81ff>install</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>delete-branch</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>add-paths</span>: <span style=color:#ae81ff>uv.lock</span>
</span></span></code></pre></div><h2 id=usage>Usage</h2><ol><li>In your repository&rsquo;s &ldquo;Settings>Actions>General&rdquo; menu (<a href=https://github.com/USER/REPO/settings/actions>https://github.com/USER/REPO/settings/actions</a>),
select the &ldquo;Allow GitHub Actions to create and approve pull requests&rdquo; checkbox
at the bottom of the page</li><li>Copy the workflow YAML file shown above to <code>.github/workflows/update-bot.yaml</code></li></ol><p>That&rsquo;s it! The workflow will automagically run on a cron schedule, creating
a PR to version bump your <code>uv</code> dependencies. An example PR generated by the
action on this demo repo is available
<a href=https://github.com/EdmundGoodman/update-bot/pull/3>here</a>, and shown in the
screenshot below:</p><figure><img src=/images/posts/update_bot/PR.png alt="Screenshot of the generated pull request"><figcaption><p>Screenshot of the generated pull request.</p></figcaption></figure><p>In combination with GitHub Actions running your test suite against PRs, you
should be able to merge them with confidence!</p><h2 id=providence>Providence</h2><p>This workflow was created to fill the need identified in the
<a href=https://github.com/xdslproject/xdsl/pull/3294#pullrequestreview-2364817663>xDSL project when switching to uv</a>.</p><p>Some other <a href=https://github.com/cookiecutter/cookiecutter-django/pull/5422/files#diff-7d4a36230fcdffc1f740d6dee07ed4c50c4dbc6874d26515a7649c089ede1bb7>workflows to perform a similar task</a>
(<a href=https://browniebroke.com/blog/keep-uv.lock-file-up-to-date-with-dependabot-updates/>blog post here</a>)
have been created, but these directly commit to the main branch, which could
result in broken code on the release branch if the dependencies change in an
unexpected way.</p><p>The mechanism for pull requesting the change rather than directly committing it
was <a href=https://pixi.sh/dev/advanced/updates_github_actions/>shown here</a>, but
targeting a different package manager.</p></article></main><footer><p>© 2024 Edmund Goodman | 
<a href=https://github.com/EdmundGoodman/edmundgoodman.github.io>Source</a> | 
<a href=https://creativecommons.org/licenses/by-nc/4.0/>License</a></p><footer></body></html>